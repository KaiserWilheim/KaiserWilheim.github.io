<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/pics/apple-touch-icon-kw.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/pics/128kw.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/pics/64kw.png">
  <link rel="mask-icon" href="/pics/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.cn/css?family=Noto+Sans:300,300italic,400,400italic,700,700italic%7CNoto+Serif+Tangut:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css">
  <script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"kaiserwilheim.eu.org","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":true,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="后缀数组(SA)。">
<meta property="og:type" content="article">
<meta property="og:title" content="后缀数组">
<meta property="og:url" content="https://kaiserwilheim.eu.org/OI/suffix-array/index.html">
<meta property="og:site_name" content="南陽劉子驥的博客">
<meta property="og:description" content="后缀数组(SA)。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-27T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-25T06:29:31.093Z">
<meta property="article:author" content="南陽劉子驥 aka KaiserWilheim">
<meta property="article:tag" content="字符串">
<meta property="article:tag" content="数据结构">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://kaiserwilheim.eu.org/OI/suffix-array/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://kaiserwilheim.eu.org/OI/suffix-array/","path":"OI/suffix-array/","title":"后缀数组"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>后缀数组 | 南陽劉子驥的博客</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Y88Y81XL7"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-8Y88Y81XL7","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">南陽劉子驥的博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">逻辑搭建基础，变幻点燃世界</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">20</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">46</span></a></li><li class="menu-item menu-item-friends"><a href="/friends/" rel="section"><i class="fa fa-address-card fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-number">1.</span> <span class="nav-text">排序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#O-n-2-log-n-%E5%81%9A%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">$O(n^2 \log n)$ 做法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#O-n-log-2-n-%E5%81%9A%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">$O(n \log^2 n)$ 做法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#O-n-log-n-%E5%81%9A%E6%B3%95"><span class="nav-number">1.3.</span> <span class="nav-text">$O(n \log n)$ 做法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E5%85%B3%E9%94%AE%E5%AD%97%E6%97%A0%E9%9C%80%E8%AE%A1%E6%95%B0%E6%8E%92%E5%BA%8F"><span class="nav-number">1.3.1.</span> <span class="nav-text">第二关键字无需计数排序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#height-%E6%95%B0%E7%BB%84"><span class="nav-number">2.</span> <span class="nav-text">height 数组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#O-n-%E6%B1%82-height-%E6%95%B0%E7%BB%84%E9%9C%80%E8%A6%81%E7%9A%84%E4%B8%80%E4%B8%AA%E5%BC%95%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">$O(n)$ 求 height 数组需要的一个引理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#O-n-%E6%B1%82-height-%E6%95%B0%E7%BB%84%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.3.</span> <span class="nav-text">$O(n)$ 求 height 数组的代码实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#height-%E6%95%B0%E7%BB%84%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">2.4.</span> <span class="nav-text">height 数组的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%A4%E5%AD%90%E4%B8%B2%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80"><span class="nav-number">2.4.1.</span> <span class="nav-text">两子串最长公共前缀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%AD%90%E4%B8%B2%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%85%B3%E7%B3%BB"><span class="nav-number">2.4.2.</span> <span class="nav-text">比较一个字符串的两个子串的大小关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E5%AD%90%E4%B8%B2%E7%9A%84%E6%95%B0%E7%9B%AE"><span class="nav-number">2.4.3.</span> <span class="nav-text">不同子串的数目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BA%E7%8E%B0%E8%87%B3%E5%B0%91-k-%E6%AC%A1%E7%9A%84%E5%AD%90%E4%B8%B2%E7%9A%84%E6%9C%80%E5%A4%A7%E9%95%BF%E5%BA%A6"><span class="nav-number">2.4.4.</span> <span class="nav-text">出现至少 k 次的子串的最大长度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%AF%E5%90%A6%E6%9C%89%E6%9F%90%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9C%A8%E6%96%87%E6%9C%AC%E4%B8%B2%E4%B8%AD%E8%87%B3%E5%B0%91%E4%B8%8D%E9%87%8D%E5%8F%A0%E5%9C%B0%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%A4%E6%AC%A1"><span class="nav-number">2.4.5.</span> <span class="nav-text">是否有某字符串在文本串中至少不重叠地出现了两次</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E7%BB%AD%E7%9A%84%E8%8B%A5%E5%B9%B2%E4%B8%AA%E7%9B%B8%E5%90%8C%E5%AD%90%E4%B8%B2"><span class="nav-number">2.4.6.</span> <span class="nav-text">连续的若干个相同子串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="nav-number">2.4.7.</span> <span class="nav-text">结合并查集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="nav-number">2.4.8.</span> <span class="nav-text">结合线段树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E5%8D%95%E8%B0%83%E6%A0%88"><span class="nav-number">2.4.9.</span> <span class="nav-text">结合单调栈</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="南陽劉子驥 aka KaiserWilheim"
      src="https://s2.loli.net/2022/03/22/7wOGBae2UblHjMI.png">
  <p class="site-author-name" itemprop="name">南陽劉子驥 aka KaiserWilheim</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0thaXNlcldpbGhlaW0=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;KaiserWilheim"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMzQ2MzA0MjM1" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;346304235"><i class="fa fa-tv fa-fw"></i>Bilibili</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9AbmFueWFuZ2xpdXppamk=" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;@nanyangliuziji"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90Lm1lL0thaXNlcldpbGhlaW0=" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;KaiserWilheim"><i class="fab fa-telegram fa-fw"></i>Telegram</span>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLW5kLzQuMC96aC1DTg=="><img src="/lib/@creativecommons/vocabulary/assets/license_badges/big/by_nc_nd.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Friends
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmJhb3NodW8ucmVuLw==" title="https:&#x2F;&#x2F;blog.baoshuo.ren&#x2F;">宝硕博客</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9jbG91ZHlza3lldC5naXRodWIuaW8v" title="https:&#x2F;&#x2F;cloudyskyet.github.io&#x2F;">Blog of Cloudysky</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly95b3V3aWtlLmdpdGh1Yi5pby8=" title="https:&#x2F;&#x2F;youwike.github.io&#x2F;">Blog of Youwike</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9zanplenN5eHguZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;sjzezsyxx.github.io&#x2F;">二南信竞团队</span>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0thaXNlcldpbGhlaW0=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kaiserwilheim.eu.org/OI/suffix-array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s2.loli.net/2022/03/22/7wOGBae2UblHjMI.png">
      <meta itemprop="name" content="南陽劉子驥 aka KaiserWilheim">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="南陽劉子驥的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="后缀数组 | 南陽劉子驥的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          后缀数组
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-28 00:00:00" itemprop="dateCreated datePublished" datetime="2022-01-28T00:00:00+08:00">2022-01-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-25 14:29:31" itemprop="dateModified" datetime="2022-05-25T14:29:31+08:00">2022-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%97%E7%AC%A6%E4%B8%B2/" itemprop="url" rel="index"><span itemprop="name">字符串</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>后缀数组(SA)。</p>
<span id="more"></span>

<p>后缀数组主要维护的是两个数组：<code>sa[]</code>和<code>rk[]</code>。<br>其中，<code>sa[i]</code>表示将所有后缀进行排序之后第 $i$ 小的后缀的编号，<code>rk[i]</code>表示第 $i$ 个后缀的排名是多少。</p>
<p>我们容易看出，sa和rk两个数组互相指向对方，即<code>sa[rk[i]]=rk[sa[i]]=i</code>。</p>
<h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><p>我们知道了后缀数组维护的主要信息了，就可以开始排序了。<br>我们定义空字符比任何字符都要小，这样保证了长度不同的后缀可以进行排序。</p>
<h2 id="O-n-2-log-n-做法"><a href="#O-n-2-log-n-做法" class="headerlink" title="$O(n^2 \log n)$ 做法"></a>$O(n^2 \log n)$ 做法</h2><p>我们可以直接使用<code>string</code>来存储数据，之后使用<code>sort</code>函数来进行排序。<br>由于比较两个字符串的时间复杂度是 $O(n)$ 的，所以总的时间复杂度是 $O(n^2 \log n)$ 的。</p>
<h2 id="O-n-log-2-n-做法"><a href="#O-n-log-2-n-做法" class="headerlink" title="$O(n \log^2 n)$ 做法"></a>$O(n \log^2 n)$ 做法</h2><p>我们考虑倍增优化排序。</p>
<p>我们首先对长度较小的后缀进行排序，之后将已经排好序的子串当做第二关键字进行排序。每一次的第二关键字的长度是倍增的，所以我们可以优化出来一个log。</p>
<details class="note default"><summary><p>参考代码 from OI Wiki</p>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n, w, sa[N], rk[N &lt;&lt; <span class="number">1</span>], oldrk[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="comment">// 为了防止访问 rk[i+w] 导致数组越界，开两倍数组。</span></span><br><span class="line"><span class="comment">// 当然也可以在访问前判断是否越界，但直接开两倍数组方便一些。</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> i, p;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) sa[i] = i, rk[i] = s[i];</span><br><span class="line">  <span class="keyword">for</span> (w = <span class="number">1</span>; w &lt; n; w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">sort</span>(sa + <span class="number">1</span>, sa + n + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">      <span class="keyword">return</span> rk[x] == rk[y] ? rk[x + w] &lt; rk[y + w] : rk[x] &lt; rk[y];&#125;);  <span class="comment">// 这里用到了 lambda</span></span><br><span class="line">    <span class="built_in">memcpy</span>(oldrk, rk, <span class="built_in">sizeof</span>(rk));</span><br><span class="line">    <span class="comment">// 由于计算 rk 的时候原来的 rk 会被覆盖，要先复制一份</span></span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (oldrk[sa[i]] == oldrk[sa[i - <span class="number">1</span>]] &amp;&amp; oldrk[sa[i] + w] == oldrk[sa[i - <span class="number">1</span>] + w]) &#123;</span><br><span class="line">        rk[sa[i]] = p;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        rk[sa[i]] = ++p;</span><br><span class="line">      &#125;  <span class="comment">// 若两个子串相同，它们对应的 rk 也需要相同，所以要去重</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, sa[i]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<h2 id="O-n-log-n-做法"><a href="#O-n-log-n-做法" class="headerlink" title="$O(n \log n)$ 做法"></a>$O(n \log n)$ 做法</h2><p>我们尝试优化排序的速度。<br>在刚刚的代码中，排序的时间复杂度是 $O(n \log n)$ 的。如果我们将排序优化到 $O(n)$ 那么就可以减小总时间复杂度到 $O(n \log n)$ 。</p>
<p>我们尝试使用计数排序来优化我们的时间复杂度。<br>由于后缀数组排序时的关键字的排名，值域为 $O(n)$ ，而且是一个双关键字的排序，可以使用计数排序来优化至 $O(n)$ 。</p>
<p>同时我们考虑一些优化。</p>
<h3 id="第二关键字无需计数排序"><a href="#第二关键字无需计数排序" class="headerlink" title="第二关键字无需计数排序"></a>第二关键字无需计数排序</h3><p>其实我们一开始已经排过序了。这些第二关键字相当于是一些原串的后缀。他们长度较小，也就优先被排过序。  </p>
<p>OI Wiki上还介绍了一些其他的优化。</p>
<details class="note primary"><summary><p>其他优化</p>
</summary>
<ul>
<li>优化计数排序的值域</li>
</ul>
<p>每次对 $rk$ 进行去重之后，我们都计算了一个 $p$ ，这个 $p$ 即是 $rk$ 的值域，将值域改成它即可。</p>
<ul>
<li>将 <code>rk[id[i]]</code> 存下来，减少不连续内存访问</li>
</ul>
<p>这个优化在数据范围较大时效果非常明显。</p>
<ul>
<li>用函数 cmp 来计算是否重复</li>
</ul>
<p>同样是减少不连续内存访问，在数据范围较大时效果比较明显。</p>
<p>把 <code>oldrk[sa[i]] == oldrk[sa[i - 1]] &amp;&amp; oldrk[sa[i] + w] == oldrk[sa[i - 1] + w]</code> 替换成 <code>cmp(sa[i], sa[i - 1], w)，bool cmp(int x, int y, int w) { return oldrk[x] == oldrk[y] &amp;&amp; oldrk[x + w] == oldrk[y + w]; }</code>。</p>
<p>若排名都不相同可直接生成后缀数组<br>考虑新的<code>rk</code>数组，若其值域为 $[1,n]$ 那么每个排名都不同，此时无需再排序。</p>

</details>

<details class="note default"><summary><p>参考代码 from OI Wiki</p>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n, sa[N], rk[N], oldrk[N &lt;&lt; <span class="number">1</span>], id[N], px[N], cnt[N];</span><br><span class="line"><span class="comment">// px[i] = rk[id[i]]（用于排序的数组所以叫 px）</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> oldrk[x] == oldrk[y] &amp;&amp; oldrk[x + w] == oldrk[y + w];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> i, m = <span class="number">300</span>, p, w;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) ++cnt[rk[i] = s[i]];</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; ++i) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) sa[cnt[rk[i]]--] = i;</span><br><span class="line">  <span class="keyword">for</span> (w = <span class="number">1</span>;; w &lt;&lt;= <span class="number">1</span>, m = p) &#123;  <span class="comment">// m=p 就是优化计数排序值域</span></span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = n; i &gt; n - w; --i) id[++p] = i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      <span class="keyword">if</span> (sa[i] &gt; w) id[++p] = sa[i] - w;</span><br><span class="line">    <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="built_in">sizeof</span>(cnt));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) ++cnt[px[i] = rk[id[i]]];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; ++i) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) sa[cnt[px[i]]--] = id[i];</span><br><span class="line">    <span class="built_in">memcpy</span>(oldrk, rk, <span class="built_in">sizeof</span>(rk));</span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      rk[sa[i]] = <span class="built_in">cmp</span>(sa[i], sa[i - <span class="number">1</span>], w) ? p : ++p;</span><br><span class="line">    <span class="keyword">if</span> (p == n) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) sa[rk[i]] = i;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, sa[i]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<h1 id="height-数组"><a href="#height-数组" class="headerlink" title="height 数组"></a><code>height</code> 数组</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>height 数组的定义如下：<br><code>height[i]=lcp(sa[i],sa[i-1])</code>，<br>即第 $i$ 名的后缀与其前一名的后缀的最长公共前缀的长度。</p>
<p><code>height[1]</code>可以视作 $0$。</p>
<h2 id="O-n-求-height-数组需要的一个引理"><a href="#O-n-求-height-数组需要的一个引理" class="headerlink" title="$O(n)$ 求 height 数组需要的一个引理"></a>$O(n)$ 求 <code>height</code> 数组需要的一个引理</h2><p>$height[rk[i]]\ge height[rk[i-1]]-1$</p>
<p>证明：</p>
<p>当 $height[rk[i-1]]\le1$ 时，上式显然成立（右边小于等于 $0$）。</p>
<p>当 $height[rk[i-1]]&gt;1$ 时：</p>
<p>设后缀 $i-1$ 为 $aAD$（$A$ 是一个长度为 $height[rk[i-1]]-1$ 的字符串），那么后缀 $i$ 就是 $AD$。设后缀 $sa[rk[i-1]-1]$ 为 $aAB$，那么 $lcp(i-1,sa[rk[i-1]-1])&#x3D;aA$。由于后缀 $sa[rk[i-1]-1]+1$ 是 $AB$，一定排在后缀 $i$ 的前面，所以后缀 $sa[rk[i]-1]$ 一定含有前缀 $A$，所以 $lcp(i,sa[rk[i]-1])$ 至少是 $height[rk[i-1]]-1$。</p>
<p>简单来说：<br>$i-1$：$aAD$<br>$i$：$AD$<br>$sa[rk[i-1]-1]$：$aAB$<br>$sa[rk[i-1]-1]+1$：$AB$<br>$sa[rk[i]-1]$：$A[B&#x2F;C]$<br>$lcp(i,sa[rk[i]-1])$：$AX$（$X$ 可能为空）</p>
<h2 id="O-n-求-height-数组的代码实现"><a href="#O-n-求-height-数组的代码实现" class="headerlink" title="$O(n)$ 求 height 数组的代码实现"></a>$O(n)$ 求 <code>height</code> 数组的代码实现</h2><p>利用上面这个引理暴力求即可：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">  <span class="keyword">if</span> (rk[i] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">  <span class="keyword">if</span> (k) --k;</span><br><span class="line">  <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k]) ++k;</span><br><span class="line">  height[rk[i]] = k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>$k$ 不会超过 $n$，最多减 $n$ 次，所以最多加 $2n$ 次，总复杂度就是 $O(n)$。</p>
<h2 id="height-数组的应用"><a href="#height-数组的应用" class="headerlink" title="height 数组的应用"></a><code>height</code> 数组的应用</h2><p>摘自 OI Wiki。</p>
<h3 id="两子串最长公共前缀"><a href="#两子串最长公共前缀" class="headerlink" title="两子串最长公共前缀"></a>两子串最长公共前缀</h3><p>$lcp(sa[i],sa[j])&#x3D;\min{height[i+1..j]}$</p>
<p>感性理解：如果 $height$ 一直大于某个数，前这么多位就一直没变过；反之，由于后缀已经排好序了，不可能变了之后变回来。</p>
<p>严格证明可以参考[[2004]后缀数组 by. 徐智磊][1]。</p>
<p>有了这个定理，求两子串最长公共前缀就转化为了 <a href="../topic/rmq.md">RMQ 问题</a>。</p>
<h3 id="比较一个字符串的两个子串的大小关系"><a href="#比较一个字符串的两个子串的大小关系" class="headerlink" title="比较一个字符串的两个子串的大小关系"></a>比较一个字符串的两个子串的大小关系</h3><p>假设需要比较的是 $A&#x3D;S[a..b]$ 和 $B&#x3D;S[c..d]$ 的大小关系。</p>
<p>若 $lcp(a, c)\ge\min(|A|, |B|)$，$A &lt; B\iff |A|&lt;|B|$。</p>
<p>否则，$A &lt; B\iff rk[a]&lt; rk[c]$。</p>
<h3 id="不同子串的数目"><a href="#不同子串的数目" class="headerlink" title="不同子串的数目"></a>不同子串的数目</h3><p>子串就是后缀的前缀，所以可以枚举每个后缀，计算前缀总数，再减掉重复。</p>
<p>“前缀总数”其实就是子串个数，为 $n(n+1)&#x2F;2$。</p>
<p>如果按后缀排序的顺序枚举后缀，每次新增的子串就是除了与上一个后缀的 LCP 剩下的前缀。这些前缀一定是新增的，否则会破坏 $lcp(sa[i],sa[j])&#x3D;\min { height[i+1..j]}$ 的性质。只有这些前缀是新增的，因为 LCP 部分在枚举上一个前缀时计算过了。</p>
<p>所以答案为：</p>
<p>$\frac{n(n+1)}{2}-\sum\limits_{i&#x3D;2}^nheight[i]$</p>
<h3 id="出现至少-k-次的子串的最大长度"><a href="#出现至少-k-次的子串的最大长度" class="headerlink" title="出现至少 k 次的子串的最大长度"></a>出现至少 k 次的子串的最大长度</h3><p>例题：<span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDI4NTI=">「USACO06DEC」Milk Patterns<i class="fa fa-external-link-alt"></i></span>。</p>
<details class="note info"><summary><p>题解</p>
</summary>
<p>出现至少 $k$ 次意味着后缀排序后有至少连续 $k$ 个后缀的 LCP 是这个子串。</p>
<p>所以，求出每相邻 $k-1$ 个 $height$ 的最小值，再求这些最小值的最大值就是答案。</p>
<p>可以使用单调队列 $O(n)$ 解决，但使用其它方式也足以 AC。</p>

</details>

<details class="note info"><summary><p>参考代码</p>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">40010</span>;</span><br><span class="line"><span class="type">int</span> n, k, a[N], sa[N], rk[N], oldrk[N], id[N], px[N], cnt[<span class="number">1000010</span>], ht[N], ans;</span><br><span class="line">multiset&lt;<span class="type">int</span>&gt; t;  <span class="comment">// multiset 是最好写的实现方式</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> oldrk[x] == oldrk[y] &amp;&amp; oldrk[x + w] == oldrk[y + w];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> i, j, w, p, m = <span class="number">1000000</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;k);</span><br><span class="line">  --k;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, a + i);  <span class="comment">//求后缀数组</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) ++cnt[rk[i] = a[i]];</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; ++i) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) sa[cnt[rk[i]]--] = i;</span><br><span class="line">  <span class="keyword">for</span> (w = <span class="number">1</span>; w &lt; n; w &lt;&lt;= <span class="number">1</span>, m = p) &#123;</span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = n; i &gt; n - w; --i) id[++p] = i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      <span class="keyword">if</span> (sa[i] &gt; w) id[++p] = sa[i] - w;</span><br><span class="line">    <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="built_in">sizeof</span>(cnt));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) ++cnt[px[i] = rk[id[i]]];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; ++i) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) sa[cnt[px[i]]--] = id[i];</span><br><span class="line">    <span class="built_in">memcpy</span>(oldrk, rk, <span class="built_in">sizeof</span>(rk));</span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      rk[sa[i]] = <span class="built_in">cmp</span>(sa[i], sa[i - <span class="number">1</span>], w) ? p : ++p;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= n; ++i) &#123;  <span class="comment">//求 height</span></span><br><span class="line">    <span class="keyword">if</span> (j) --j;</span><br><span class="line">    <span class="keyword">while</span> (a[i + j] == a[sa[rk[i] - <span class="number">1</span>] + j]) ++j;</span><br><span class="line">    ht[rk[i]] = j;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) &#123;  <span class="comment">//求所有最小值的最大值</span></span><br><span class="line">    t.<span class="built_in">insert</span>(ht[i]);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; k) t.<span class="built_in">erase</span>(t.<span class="built_in">find</span>(ht[i - k]));</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, *t.<span class="built_in">begin</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; ans;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<h3 id="是否有某字符串在文本串中至少不重叠地出现了两次"><a href="#是否有某字符串在文本串中至少不重叠地出现了两次" class="headerlink" title="是否有某字符串在文本串中至少不重叠地出现了两次"></a>是否有某字符串在文本串中至少不重叠地出现了两次</h3><p>可以二分目标串的长度 $|s|$，将 $h$ 数组划分成若干个连续 LCP 大于等于 $|s|$ 的段，利用 RMQ 对每个段求其中出现的数中最大和最小的下标，若这两个下标的距离满足条件，则一定有长度为 $|s|$ 的字符串不重叠地出现了两次。</p>
<h3 id="连续的若干个相同子串"><a href="#连续的若干个相同子串" class="headerlink" title="连续的若干个相同子串"></a>连续的若干个相同子串</h3><p>我们可以枚举连续串的长度 $|s|$，按照 $|s|$ 对整个串进行分块，对相邻两块的块首进行 LCP 与 LCS 查询，具体可见[[2009]后缀数组——处理字符串的有力工具][2]。</p>
<p>例题：<span class="exturl" data-url="aHR0cHM6Ly9sb2ouYWMvcC8yMDgz">「NOI2016」优秀的拆分<i class="fa fa-external-link-alt"></i></span>。</p>
<h3 id="结合并查集"><a href="#结合并查集" class="headerlink" title="结合并查集"></a>结合并查集</h3><p>某些题目求解时要求你将后缀数组划分成若干个连续 LCP 长度大于等于某一值的段，亦即将 $h$ 数组划分成若干个连续最小值大于等于某一值的段并统计每一段的答案。如果有多次询问，我们可以将询问离线。观察到当给定值单调递减的时候，满足条件的区间个数总是越来越少，而新区间都是两个或多个原区间相连所得，且新区间中不包含在原区间内的部分的 $h$ 值都为减少到的这个值。我们只需要维护一个并查集，每次合并相邻的两个区间，并维护统计信息即可。</p>
<p>经典题目：<span class="exturl" data-url="aHR0cHM6Ly91b2ouYWMvcHJvYmxlbS8xMzE=">「NOI2015」品酒大会<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="结合线段树"><a href="#结合线段树" class="headerlink" title="结合线段树"></a>结合线段树</h3><p>某些题目让你求满足条件的前若干个数，而这些数又在后缀排序中的一个区间内。这时我们可以用归并排序的性质来合并两个结点的信息，利用线段树维护和查询区间答案。</p>
<h3 id="结合单调栈"><a href="#结合单调栈" class="headerlink" title="结合单调栈"></a>结合单调栈</h3><p>例题：<span class="exturl" data-url="aHR0cHM6Ly9sb2ouYWMvcHJvYmxlbS8yMzc3">「AHOI2013」差异<i class="fa fa-external-link-alt"></i></span></p>
<details class="note info"><summary><p>题解</p>
</summary>
<p>被加数的前两项很好处理，为 $n(n-1)(n+1)&#x2F;2$（每个后缀都出现了 $n-1$ 次，后缀总长是 $n(n+1)&#x2F;2$），关键是最后一项，即后缀的两两 LCP。</p>
<p>我们知道 $lcp(i,j)&#x3D;k$ 等价于 $\min{height[i+1..j]}&#x3D;k$。所以，可以把 $lcp(i,j)$ 记作 $\min{x|i+1\le x\le j, height[x]&#x3D;lcp(i,j)}$ 对答案的贡献。</p>
<p>考虑每个位置对答案的贡献是哪些后缀的 LCP，其实就是从它开始向左若干个连续的 $height$ 大于它的后缀中选一个，再从向右若干个连续的 $height$ 不小于它的后缀中选一个。这个东西可以用单调栈计算。</p>
<p>单调栈部分类似于 <span class="exturl" data-url="aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDI2NTk=">Luogu P2659 美丽的序列<i class="fa fa-external-link-alt"></i></span> 以及悬线法。</p>

</details>

<details class="note default"><summary><p>参考代码</p>
</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500010</span>;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n, sa[N], rk[N &lt;&lt; <span class="number">1</span>], oldrk[N &lt;&lt; <span class="number">1</span>], id[N], px[N], cnt[N], ht[N], sta[N],</span><br><span class="line">    top, l[N];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> oldrk[x] == oldrk[y] &amp;&amp; oldrk[x + w] == oldrk[y + w];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> i, k, w, p, m = <span class="number">300</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">  ans = <span class="number">1ll</span> * n * (n - <span class="number">1</span>) * (n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">  <span class="comment">//求后缀数组</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) ++cnt[rk[i] = s[i]];</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; ++i) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) sa[cnt[rk[i]]--] = i;</span><br><span class="line">  <span class="keyword">for</span> (w = <span class="number">1</span>; w &lt; n; w &lt;&lt;= <span class="number">1</span>, m = p) &#123;</span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = n; i &gt; n - w; --i) id[++p] = i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      <span class="keyword">if</span> (sa[i] &gt; w) id[++p] = sa[i] - w;</span><br><span class="line">    <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="built_in">sizeof</span>(cnt));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) ++cnt[px[i] = rk[id[i]]];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; ++i) cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) sa[cnt[px[i]]--] = id[i];</span><br><span class="line">    <span class="built_in">memcpy</span>(oldrk, rk, <span class="built_in">sizeof</span>(rk));</span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">0</span>, i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      rk[sa[i]] = <span class="built_in">cmp</span>(sa[i], sa[i - <span class="number">1</span>], w) ? p : ++p;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//求 height</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (k) --k;</span><br><span class="line">    <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k]) ++k;</span><br><span class="line">    ht[rk[i]] = k;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//维护单调栈</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">while</span> (ht[sta[top]] &gt; ht[i]) --top;  <span class="comment">// top类似于一个指针</span></span><br><span class="line">    l[i] = i - sta[top];</span><br><span class="line">    sta[++top] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//最后利用单调栈算 ans</span></span><br><span class="line">  sta[++top] = n + <span class="number">1</span>;</span><br><span class="line">  ht[n + <span class="number">1</span>] = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">    <span class="keyword">while</span> (ht[sta[top]] &gt;= ht[i]) --top;</span><br><span class="line">    ans -= <span class="number">2ll</span> * ht[i] * l[i] * (sta[top] - i);</span><br><span class="line">    sta[++top] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; ans;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>类似的题目：<span class="exturl" data-url="aHR0cHM6Ly9sb2ouYWMvcHJvYmxlbS8yMDY0">「HAOI2016」找相同字符<i class="fa fa-external-link-alt"></i></span>。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>南陽劉子驥 aka KaiserWilheim
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://kaiserwilheim.eu.org/OI/suffix-array/" title="后缀数组">https://kaiserwilheim.eu.org/OI/suffix-array/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLW5kLzQuMC96aC1DTg=="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" rel="tag"># 字符串</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag"># 数据结构</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/OI/suffix-avtomat/" rel="prev" title="后缀自动机">
                  <i class="fa fa-chevron-left"></i> 后缀自动机
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/maths/eular-and-m%C3%B6bius/" rel="next" title="欧拉和莫比乌斯">
                  欧拉和莫比乌斯 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">南陽劉子驥 aka KaiserWilheim</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">271k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:06</span>
  </span>
</div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/lib/pangu/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"/lib/mathjax/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="/lib/gitalk/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"KaiserWilheim","repo":"Blog-Gitalk","client_id":"3e37bb1d7df7fd5db91f","client_secret":"c23d4e5da80a5bc983c11ce4de5161b218b394c8","admin_user":"KaiserWilheim","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"/lib/gitalk/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"a33324e0a65e306918f4146b4fe9323d"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
